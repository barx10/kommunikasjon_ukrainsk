<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ë–∞–∑–æ–≤–∞ –Ω–æ—Ä–≤–µ–∑—å–∫–∞ –∫–æ–º—É–Ω—ñ–∫–∞—Ü—ñ—è (Norsk grunnleggende kommunikasjon)</title>
  <style>
    /* ----- B A S E  +  K O N T R A S T ----- */
    :root {
      --bg: #ffffff;
      --fg: #111111;
      --muted: #2b2b2b;
      --card: #f3f3f3;
      --card-border: #c9c9c9;
      --focus: #005fcc;
      --accent: #0a66c2;
      --chip: #e9eef6;
    }

    html, body { height: 100%; }
    body {
      margin: 0;
      background: var(--bg);
      color: var(--fg);
      font: 16px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
    }

    * { box-sizing: border-box; }
    *:focus-visible { outline: 3px solid var(--focus); outline-offset: 3px; }

    @media (prefers-reduced-motion: reduce) { *,*::before,*::after{ animation:none !important; transition:none !important; } }

    header { padding: 12px 16px; border-bottom: 2px solid var(--card-border); display: grid; gap: 10px; }
    .topbar { display: flex; flex-wrap: wrap; gap: 8px; align-items: center; }
    .title { font-size: 1.1rem; font-weight: 700; margin-right: auto; }

    .controls { display: grid; gap: 8px; }

    .searchbar { display: flex; gap: 6px; align-items: center; }
    .searchbar input[type="search"] { flex: 1; min-height: 48px; padding: 10px 12px; border: 2px solid var(--card-border); border-radius: 8px; font-size: 1rem; }

    .btn { min-height: 48px; min-width: 48px; padding: 10px 12px; border-radius: 10px; border: 2px solid var(--card-border); background: #fafafa; color: var(--fg); font-weight: 600; cursor: pointer; }

    .filters { display: flex; flex-wrap: wrap; gap: 6px; }
    .chip { background: var(--chip); border: 2px solid var(--card-border); border-radius: 999px; padding: 8px 12px; min-height: 48px; cursor: pointer; font-weight: 600; }
    .chip[aria-pressed="true"] { background: #d9e9ff; border-color: var(--accent); }

    main { padding: 16px; }
    .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 12px; }

    .card { display: grid; grid-template-rows: auto auto auto auto; gap: 6px; padding: 14px; min-height: 160px; background: var(--card); border: 2px solid var(--card-border); border-radius: 14px; }
    .card[tabindex="0"] { cursor: pointer; }
    .emoji { font-size: 2rem; }
    .no { font-size: 1.35rem; font-weight: 800; letter-spacing: .2px; }
    .uk { font-size: .95rem; color: var(--muted); }

    .actions { display: flex; gap: 8px; margin-top: 8px; }
    .iconbtn { min-width: 48px; min-height: 48px; border-radius: 10px; border: 2px solid var(--card-border); background: #fff; font-size: 1.2rem; cursor: pointer; }

    .status { margin: 8px 16px 16px; padding: 10px 12px; border: 2px solid var(--card-border); border-radius: 8px; background: #fff; }

    @media (max-width: 480px) { .grid { grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); } }
  </style>
</head>
<body>
  <header>
    <div class="topbar">
      <div class="title" aria-label="–ù–∞–∑–≤–∞">–ë–∞–∑–æ–≤–∞ –Ω–æ—Ä–≤–µ–∑—å–∫–∞ –∫–æ–º—É–Ω—ñ–∫–∞—Ü—ñ—è (Norsk grunnleggende kommunikasjon)</div>
    </div>

    <div class="controls" id="controls" aria-label="–ü–∞–Ω–µ–ª—å –∫–µ—Ä—É–≤–∞–Ω–Ω—è">
      <div class="searchbar">
        <input id="search" type="search" placeholder="–ü–æ—à—É–∫" aria-label="–ü–æ—à—É–∫ —Ñ—Ä–∞–∑" />
        <button id="clearSearch" class="btn" type="button" aria-label="–û—á–∏—Å—Ç–∏—Ç–∏ –ø–æ—à—É–∫">–û—á–∏—Å—Ç–∏—Ç–∏ (T√∏m)</button>
      </div>

      <div class="filters" role="group" aria-label="–§—ñ–ª—å—Ç—Ä –∑–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è–º–∏">
        <button class="chip" type="button" data-cat="–£—Å—ñ" aria-pressed="true" aria-label="–ü–æ–∫–∞–∑–∞—Ç–∏ –≤—Å—ñ">–£—Å—ñ (Alle)</button>
        <button class="chip" type="button" data-cat="–ü–æ—Ç—Ä–µ–±–∏" aria-pressed="false" aria-label="–§—ñ–ª—å—Ç—Ä –∑–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—î—é: –ü–æ—Ç—Ä–µ–±–∏">–ü–æ—Ç—Ä–µ–±–∏ (Behov)</button>
        <button class="chip" type="button" data-cat="–ü–æ—á—É—Ç—Ç—è" aria-pressed="false" aria-label="–§—ñ–ª—å—Ç—Ä –∑–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—î—é: –ü–æ—á—É—Ç—Ç—è">–ü–æ—á—É—Ç—Ç—è (F√∏lelser)</button>
        <button class="chip" type="button" data-cat="–£ —à–∫–æ–ª—ñ" aria-pressed="false" aria-label="–§—ñ–ª—å—Ç—Ä –∑–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—î—é: –£ —à–∫–æ–ª—ñ">–£ —à–∫–æ–ª—ñ (P√• skolen)</button>
      </div>
    </div>
  </header>

  <main>
    <section id="cards" class="grid" aria-label="–ö–∞—Ä—Ç–∫–∏ —Ñ—Ä–∞–∑"></section>
  </main>

  <div class="status" id="status" role="status" aria-live="polite">–ì–æ—Ç–æ–≤–æ</div>

  <script>
    // ===================== D A T A =====================
    const DATA = [
      { no: "Jeg er sulten", uk: "–Ø –≥–æ–ª–æ–¥–Ω–∏–π", emoji: "üçΩÔ∏è", cat: "–ü–æ—Ç—Ä–µ–±–∏", alt: ["mat", "spise", "hungry", "—ó–∂–∞", "—Ö–æ—á—É —ó—Å—Ç–∏", "–≥–æ–ª–æ–¥–Ω–∏–π"] },
      { no: "Jeg er t√∏rst", uk: "–Ø —Ö–æ—á—É –ø–∏—Ç–∏", emoji: "üíß", cat: "–ü–æ—Ç—Ä–µ–±–∏", alt: ["drikke", "vann", "thirsty", "–ø–∏—Ç–∏", "–≤–æ–¥–∞", "—Å–ø—Ä–∞–≥–∞"] },
      { no: "Jeg m√• p√• do", uk: "–ú–µ–Ω—ñ –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤ —Ç—É–∞–ª–µ—Ç", emoji: "üöª", cat: "–ü–æ—Ç—Ä–µ–±–∏", alt: ["toalett", "wc", "bathroom", "—Ç—É–∞–ª–µ—Ç", "–≤ —Ç—É–∞–ª–µ—Ç"] },
      { no: "Jeg trenger en pause", uk: "–ú–µ–Ω—ñ –ø–æ—Ç—Ä—ñ–±–Ω–∞ –ø–µ—Ä–µ—Ä–≤–∞", emoji: "‚è∏Ô∏è", cat: "–ü–æ—Ç—Ä–µ–±–∏", alt: ["hvile", "break", "–ø–µ—Ä–µ—Ä–≤–∞"] },
      { no: "Jeg er sliten", uk: "–Ø –≤—Ç–æ–º–∏–≤—Å—è", emoji: "üò¥", cat: "–ü–æ—Ç—Ä–µ–±–∏", alt: ["tr√∏tt", "slapp", "tired", "–≤—Ç–æ–º–∞", "–≤—Ç–æ–º–∏–≤—Å—è"] },
      { no: "Kan jeg hente vann", uk: "–ß–∏ –º–æ–∂–Ω–∞ –≤–∑—è—Ç–∏ –≤–æ–¥–∏", emoji: "üö∞", cat: "–ü–æ—Ç—Ä–µ–±–∏", alt: ["drikke", "vann", "–≤–æ–¥–∞", "–ø–∏—Ç–∏"] },
      { no: "Kan jeg g√• ut litt", uk: "–ß–∏ –º–æ–∂–Ω–∞ –≤–∏–π—Ç–∏ –Ω–∞ —Ö–≤–∏–ª–∏–Ω–∫—É", emoji: "üö™", cat: "–ü–æ—Ç—Ä–µ–±–∏", alt: ["ute", "g√• ut", "–≤–∏–π—Ç–∏", "–Ω–∞ –≤—É–ª–∏—Ü—é"] },
      { no: "Dette er bra", uk: "–¶–µ –¥–æ–±—Ä–µ", emoji: "üëç", cat: "–ü–æ—á—É—Ç—Ç—è", alt: ["fint", "ok", "bra", "–¥–æ–±—Ä–µ"] },
      { no: "Dette er d√•rlig", uk: "–¶–µ –ø–æ–≥–∞–Ω–æ", emoji: "üëé", cat: "–ü–æ—á—É—Ç—Ç—è", alt: ["ikke bra", "bad", "–ø–æ–≥–∞–Ω–æ"] },
      { no: "Dette er g√∏y", uk: "–¶–µ –≤–µ—Å–µ–ª–æ", emoji: "üòÑ", cat: "–ü–æ—á—É—Ç—Ç—è", alt: ["morsomt", "fun", "–≤–µ—Å–µ–ª–æ"] },
      { no: "Dette er kjedelig", uk: "–¶–µ –Ω—É–¥–Ω–æ", emoji: "üòê", cat: "–ü–æ—á—É—Ç—Ç—è", alt: ["ikke g√∏y", "boring", "–Ω—É–¥–Ω–æ"] },
      { no: "Jeg er glad", uk: "–Ø —Ä–∞–¥–∏–π", emoji: "üôÇ", cat: "–ü–æ—á—É—Ç—Ç—è", alt: ["happy", "glad", "—Ä–∞–¥—ñ—Å–Ω–∏–π"] },
      { no: "Jeg er trist", uk: "–ú–µ–Ω—ñ —Å—É–º–Ω–æ", emoji: "üò¢", cat: "–ü–æ—á—É—Ç—Ç—è", alt: ["lei seg", "sad", "—Å—É–º–Ω–æ"] },
      { no: "Jeg er sint", uk: "–Ø –∑–ª—é—Å—è", emoji: "üò†", cat: "–ü–æ—á—É—Ç—Ç—è", alt: ["sur", "arg", "sint", "–∑–ª–∏–π"] },
      { no: "Jeg er redd", uk: "–ú–µ–Ω—ñ —Å—Ç—Ä–∞—à–Ω–æ", emoji: "üò®", cat: "–ü–æ—á—É—Ç—Ç—è", alt: ["frykt", "engstelig", "redd", "—Å—Ç—Ä–∞—à–Ω–æ"] },
      { no: "Jeg forst√•r", uk: "–Ø —Ä–æ–∑—É–º—ñ—é", emoji: "‚úÖ", cat: "–£ —à–∫–æ–ª—ñ", alt: ["skj√∏nner", "understand", "—Ä–æ–∑—É–º—ñ—é"] },
      { no: "Jeg forst√•r ikke", uk: "–Ø –Ω–µ —Ä–æ–∑—É–º—ñ—é", emoji: "‚ùì", cat: "–£ —à–∫–æ–ª—ñ", alt: ["vet ikke", "don't understand", "–Ω–µ —Ä–æ–∑—É–º—ñ—é"] },
      { no: "Kan du hjelpe meg", uk: "–ß–∏ –º–æ–∂–µ—Ç–µ –≤–∏ –º–µ–Ω—ñ –¥–æ–ø–æ–º–æ–≥—Ç–∏", emoji: "üôã", cat: "–£ —à–∫–æ–ª—ñ", alt: ["hjelp", "help", "–¥–æ–ø–æ–º–æ–≥–∞"] },
      { no: "Kan du si det en gang til", uk: "–ü–æ–≤—Ç–æ—Ä—ñ—Ç—å, –±—É–¥—å –ª–∞—Å–∫–∞", emoji: "üîÅ", cat: "–£ —à–∫–æ–ª—ñ", alt: ["gjenta", "repeat", "—â–µ —Ä–∞–∑"] },
      { no: "Kan jeg jobbe alene", uk: "–ß–∏ –º–æ–∂–Ω–∞ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ —Å–∞–º–æ–º—É", emoji: "üôá", cat: "–£ —à–∫–æ–ª—ñ", alt: ["selv", "alone", "—Å–∞–º"] },
      { no: "Kan jeg jobbe sammen", uk: "–ß–∏ –º–æ–∂–Ω–∞ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ —Ä–∞–∑–æ–º", emoji: "üë•", cat: "–£ —à–∫–æ–ª—ñ", alt: ["gruppe", "sammen", "—Ä–∞–∑–æ–º"] },
      { no: "Det er for vanskelig", uk: "–¶–µ –∑–∞–Ω–∞–¥—Ç–æ —Å–∫–ª–∞–¥–Ω–æ", emoji: "üß©", cat: "–£ —à–∫–æ–ª—ñ", alt: ["ikke lett", "difficult", "—Å–∫–ª–∞–¥–Ω–æ"] },
      { no: "Det er for lett", uk: "–¶–µ –∑–∞–Ω–∞–¥—Ç–æ –ª–µ–≥–∫–æ", emoji: "üü¢", cat: "–£ —à–∫–æ–ª—ñ", alt: ["enkelt", "easy", "–ª–µ–≥–∫–æ"] },
    ].map((x, i) => ({ ...x, idx: i }));

    // ===================== S T A T E  +  F A V S =====================
    const state = { query: "", cat: "–£—Å—ñ", rate: 0.9 };
    const FAV_KEY = "fav_phrases_v1";
    const favSet = new Set(JSON.parse(localStorage.getItem(FAV_KEY) || "[]"));
    function persistFavs() { localStorage.setItem(FAV_KEY, JSON.stringify([...favSet])); }

    // ===================== H E L P E R S =====================
    function fold(s) {
      return (s || "")
        .normalize('NFD')
        .replace(/\p{Diacritic}/gu, '')
        .replace(/√¶/g, 'ae')
        .replace(/√∏/g, 'o')
        .replace(/√•/g, 'aa')
        .toLowerCase();
    }

    function isMatch(item, q) {
      if (!q) return true;
      const hay = fold([item.no, item.uk, ...(item.alt || [])].join(' '));
      const tokens = fold(q).split(/\s+/).filter(Boolean);
      // Alle ord i s√∏ket m√• finnes et eller annet sted i frasen/alternativene
      return tokens.every(t => hay.includes(t));
    }

    function sortWithFavs(items) {
      return items.slice().sort((a, b) => {
        const af = favSet.has(a.no) ? 1 : 0;
        const bf = favSet.has(b.no) ? 1 : 0;
        if (af !== bf) return bf - af; // favoritter f√∏rst
        return a.idx - b.idx;          // stabilt ellers
      });
    }

    // ===================== R E N D E R =====================
    const cardsEl = document.getElementById('cards');
    const statusEl = document.getElementById('status');
    function announce(msg) { statusEl.textContent = msg; }

    function render() {
      const filtered = DATA.filter(x => (state.cat === "–£—Å—ñ" || x.cat === state.cat) && isMatch(x, state.query));
      const arr = sortWithFavs(filtered);
      cardsEl.innerHTML = "";

      for (const item of arr) {
        const card = document.createElement('article');
        card.className = 'card';
        card.setAttribute('tabindex', '0');
        card.setAttribute('role', 'button');
        card.setAttribute('aria-label', `–í—ñ–¥—Ç–≤–æ—Ä–∏—Ç–∏ —Ñ—Ä–∞–∑—É –Ω–æ—Ä–≤–µ–∑—å–∫–æ—é: ${item.no}`);
        card.dataset.no = item.no;
        card.dataset.cat = item.cat;

        const emoji = document.createElement('div');
        emoji.className = 'emoji';
        emoji.textContent = item.emoji;
        emoji.setAttribute('aria-hidden', 'true');

        const no = document.createElement('div');
        no.className = 'no';
        no.textContent = item.no; // norsk stor √∏verst

        const uk = document.createElement('div');
        uk.className = 'uk';
        uk.textContent = `${item.uk} (${item.no})`;

        const actions = document.createElement('div');
        actions.className = 'actions';

        const speakBtn = document.createElement('button');
        speakBtn.className = 'iconbtn';
        speakBtn.type = 'button';
        speakBtn.textContent = 'üîä';
        speakBtn.setAttribute('aria-label', `–ü—Ä–æ—Å–ª—É—Ö–∞—Ç–∏ –Ω–æ—Ä–≤–µ–∑—å–∫—É —Ñ—Ä–∞–∑—É: ${item.no}`);

        const favBtn = document.createElement('button');
        favBtn.className = 'iconbtn';
        favBtn.type = 'button';
        const isFav = favSet.has(item.no);
        favBtn.textContent = isFav ? '‚≠ê' : '‚òÜ';
        favBtn.setAttribute('aria-label', (isFav ? '–í–∏–ª—É—á–∏—Ç–∏ –∑ –æ–±—Ä–∞–Ω–æ–≥–æ: ' : '–î–æ–¥–∞—Ç–∏ –¥–æ –æ–±—Ä–∞–Ω–æ–≥–æ: ') + item.no);
        favBtn.setAttribute('aria-pressed', String(isFav));
        favBtn.title = '–û–±—Ä–∞–Ω–µ';

        actions.appendChild(speakBtn);
        actions.appendChild(favBtn);

        card.appendChild(emoji);
        card.appendChild(no);
        card.appendChild(uk);
        card.appendChild(actions);

        card.addEventListener('click', (e) => {
          if ((e.target instanceof HTMLElement) && e.target.closest('button')) return;
          speak(item.no);
        });
        card.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            speak(item.no);
          }
        });

        speakBtn.addEventListener('click', () => speak(item.no));
        favBtn.addEventListener('click', (ev) => {
          ev.stopPropagation();
          if (favSet.has(item.no)) { favSet.delete(item.no); } else { favSet.add(item.no); }
          persistFavs();
          render();
        });

        cardsEl.appendChild(card);
      }

      if (arr.length === 0) announce('–ù—ñ—á–æ–≥–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ'); else announce('–ì–æ—Ç–æ–≤–æ');
    }

    // ===================== S √ò K  +  F I L T E R =====================
    const searchInput = document.getElementById('search');
    const clearSearchBtn = document.getElementById('clearSearch');

    searchInput.addEventListener('input', () => { state.query = searchInput.value; render(); });
    clearSearchBtn.addEventListener('click', () => { searchInput.value = ''; state.query = ''; render(); searchInput.focus(); });

    document.querySelectorAll('.chip').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.chip').forEach(b => b.setAttribute('aria-pressed', 'false'));
        btn.setAttribute('aria-pressed', 'true');
        state.cat = btn.dataset.cat;
        render();
      });
    });

    // ===================== T A L E  (speechSynthesis) =====================
    let selectedVoice = null;

    function pickVoice() {
      const voices = window.speechSynthesis.getVoices();
      if (!voices || voices.length === 0) return null;
      const wanted = voices.find(v => /^nb|^no|^nn/i.test(v.lang));
      return wanted || voices[0];
    }

    function ensureVoiceReady() {
      selectedVoice = pickVoice();
      if (selectedVoice) {
        const useFallback = !/^nb|^no|^nn/i.test(selectedVoice.lang || '');
        announce(useFallback ? '–ì–æ–ª–æ—Å –∑–Ω–∞–π–¥–µ–Ω–æ (—Ä–µ–∑–µ—Ä–≤–Ω–∏–π).' : '–ì–æ–ª–æ—Å –Ω–æ—Ä–≤–µ–∑—å–∫–æ—é –≥–æ—Ç–æ–≤–∏–π.');
      } else {
        announce('–ì–æ–ª–æ—Å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π. –°–ø—Ä–æ–±—É–π—Ç–µ –ø—ñ–∑–Ω—ñ—à–µ.');
      }
    }

    ensureVoiceReady();
    window.speechSynthesis.addEventListener('voiceschanged', ensureVoiceReady);

    function speak(text) {
      if (!('speechSynthesis' in window)) { announce('–û–∑–≤—É—á–µ–Ω–Ω—è –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è.'); return; }
      window.speechSynthesis.cancel();
      const u = new SpeechSynthesisUtterance(text);
      u.rate = state.rate; // standard hastighet
      u.lang = 'nb-NO';
      if (selectedVoice) u.voice = selectedVoice;
      u.onstart = () => announce(`–í–∏–º–æ–≤–∞: ${text}`);
      u.onend = () => announce('–ì–æ—Ç–æ–≤–æ');
      u.onerror = () => announce('–ü–æ–º–∏–ª–∫–∞ –≤—ñ–¥—Ç–≤–æ—Ä–µ–Ω–Ω—è.');
      window.speechSynthesis.speak(u);
    }

    // ===================== S T A R T =====================
    render();
  </script>
</body>
</html>
