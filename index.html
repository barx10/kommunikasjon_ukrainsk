<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ë–∞–∑–æ–≤–∞ –Ω–æ—Ä–≤–µ–∑—å–∫–∞ –∫–æ–º—É–Ω—ñ–∫–∞—Ü—ñ—è (Norsk grunnleggende kommunikasjon)</title>
  <style>
    /* FORCE UPDATE 2025-08-21 for GitHub Pages cache */
    /* ----- B A S E  +  K O N T R A S T ----- */
    :root {
      --bg: #ffffff;
      --fg: #111111;
      --muted: #2b2b2b;
      --card: #f3f3f3;
      --card-border: #c9c9c9;
      --focus: #005fcc;
      --accent: #0a66c2;
      --chip: #e9eef6;
    }

    html, body { height: 100%; }
    body {
      margin: 0;
      background: var(--bg);
      color: var(--fg);
      font: 16px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
    }

    * { box-sizing: border-box; }
    *:focus-visible { outline: 3px solid var(--focus); outline-offset: 3px; }

    @media (prefers-reduced-motion: reduce) { *,*::before,*::after{ animation:none !important; transition:none !important; } }

    header {
      padding: 28px 0 18px 0;
      background: linear-gradient(90deg, #e9eef6 0%, #d9e9ff 100%);
      border-bottom: 2px solid var(--card-border);
      box-shadow: 0 2px 8px 0 #e9eef6;
      display: grid;
      gap: 10px;
    }
    .topbar {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0;
      margin-bottom: 6px;
    }
    .title {
      display: flex;
      flex-direction: column;
      align-items: center;
      font-size: 2.1rem;
      font-weight: 800;
      letter-spacing: 0.5px;
      margin: 0;
      line-height: 1.2;
    }
    .title-emoji {
      font-size: 2.2rem;
      margin-bottom: 2px;
    }
    .title-uk {
      font-size: 1.25rem;
      font-weight: 800;
      color: #005fcc;
      margin-bottom: 2px;
    }
    .title-no {
      font-size: 1.05rem;
      font-weight: 600;
      color: #2b2b2b;
      opacity: 0.85;
    }

  .controls { display: grid; gap: 8px; justify-items: center; }

    .searchbar { display: flex; gap: 6px; align-items: center; }
    .searchbar input[type="search"] { flex: 1; min-height: 48px; padding: 10px 12px; border: 2px solid var(--card-border); border-radius: 8px; font-size: 1rem; }

    .btn { min-height: 48px; min-width: 48px; padding: 10px 12px; border-radius: 10px; border: 2px solid var(--card-border); background: #fafafa; color: var(--fg); font-weight: 600; cursor: pointer; }

  .filters { display: flex; flex-wrap: wrap; gap: 6px; justify-content: center; }
    .chip { background: var(--chip); border: 2px solid var(--card-border); border-radius: 999px; padding: 8px 12px; min-height: 48px; cursor: pointer; font-weight: 600; }
    .chip[aria-pressed="true"] { background: #d9e9ff; border-color: var(--accent); }
    .catbtn {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      width: 140px;
      min-width: 140px;
      max-width: 150px;
      min-height: 140px;
      max-height: 150px;
      padding: 18px 8px 16px 8px;
      font-weight: 600;
      gap: 0;
      text-align: center;
      overflow: hidden;
      white-space: normal;
      word-break: break-word;
      box-sizing: border-box;
      border-radius: 50%;
    }
    .cat-emoji {
      font-size: 1.7rem;
      margin-bottom: 2px;
      line-height: 1;
    }
    .cat-uk {
      font-size: 1.08rem;
      font-weight: bold;
      margin-bottom: 1px;
      line-height: 1.1;
      word-break: break-word;
    }
    .cat-no {
      font-size: 0.93rem;
      color: #444;
      opacity: 0.85;
      line-height: 1.1;
      word-break: break-word;
    }

    main { padding: 16px; }
    .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 12px; }

    .card { display: grid; grid-template-rows: auto auto auto auto; gap: 6px; padding: 14px; min-height: 160px; background: var(--card); border: 2px solid var(--card-border); border-radius: 14px; }
    .card[tabindex="0"] { cursor: pointer; }
    .emoji { font-size: 2rem; }
    .no { font-size: 1.35rem; font-weight: 800; letter-spacing: .2px; }
    .uk { font-size: .95rem; color: var(--muted); }

    .actions { display: flex; gap: 8px; margin-top: 8px; }
    .iconbtn { min-width: 48px; min-height: 48px; border-radius: 10px; border: 2px solid var(--card-border); background: #fff; font-size: 1.2rem; cursor: pointer; }

    .status { margin: 8px 16px 16px; padding: 10px 12px; border: 2px solid var(--card-border); border-radius: 8px; background: #fff; }

    @media (max-width: 480px) { .grid { grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); } }
  </style>
</head>
<body>
  <header>
    <div class="topbar">
      <div class="title" aria-label="–ù–∞–∑–≤–∞">
        <span class="title-emoji" aria-hidden="true">üó£Ô∏èüá≥üá¥üá∫üá¶</span>
        <span class="title-uk">–ë–∞–∑–æ–≤–∞ –Ω–æ—Ä–≤–µ–∑—å–∫–∞ –∫–æ–º—É–Ω—ñ–∫–∞—Ü—ñ—è</span>
        <span class="title-no">Norsk grunnleggende kommunikasjon</span>
      </div>
    </div>

    <div class="controls" id="controls" aria-label="–ü–∞–Ω–µ–ª—å –∫–µ—Ä—É–≤–∞–Ω–Ω—è">


      <div class="filters" role="group" aria-label="–§—ñ–ª—å—Ç—Ä –∑–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è–º–∏">
        <button class="chip catbtn" type="button" data-cat="–£—Å—ñ" aria-pressed="true" aria-label="–ü–æ–∫–∞–∑–∞—Ç–∏ –≤—Å—ñ">
          <span class="cat-emoji" aria-hidden="true">üåê</span>
          <span class="cat-uk">–£—Å—ñ</span>
          <span class="cat-no">(Alle)</span>
        </button>
        <button class="chip catbtn" type="button" data-cat="–ü–æ—Ç—Ä–µ–±–∏" aria-pressed="false" aria-label="–§—ñ–ª—å—Ç—Ä –∑–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—î—é: –ü–æ—Ç—Ä–µ–±–∏">
          <span class="cat-emoji" aria-hidden="true">üõ†Ô∏è</span>
          <span class="cat-uk">–ü–æ—Ç—Ä–µ–±–∏</span>
          <span class="cat-no">(Behov)</span>
        </button>
        <button class="chip catbtn" type="button" data-cat="–ü–æ—á—É—Ç—Ç—è" aria-pressed="false" aria-label="–§—ñ–ª—å—Ç—Ä –∑–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—î—é: –ü–æ—á—É—Ç—Ç—è">
          <span class="cat-emoji" aria-hidden="true">üôÇ</span>
          <span class="cat-uk">–ü–æ—á—É—Ç—Ç—è</span>
          <span class="cat-no">(F√∏lelser)</span>
        </button>
        <button class="chip catbtn" type="button" data-cat="–£ —à–∫–æ–ª—ñ" aria-pressed="false" aria-label="–§—ñ–ª—å—Ç—Ä –∑–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—î—é: –£ —à–∫–æ–ª—ñ">
          <span class="cat-emoji" aria-hidden="true">üè´</span>
          <span class="cat-uk">–£ —à–∫–æ–ª—ñ</span>
          <span class="cat-no">(P√• skolen)</span>
        </button>
        <button class="chip catbtn" type="button" data-cat="H√∏flighet" aria-pressed="false" aria-label="Filter: H√∏flighet">
          <span class="cat-emoji" aria-hidden="true">ü§ù</span>
          <span class="cat-uk">–í–≤—ñ—á–ª–∏–≤—ñ—Å—Ç—å</span>
          <span class="cat-no">(H√∏flighet)</span>
        </button>
        <button class="chip catbtn" type="button" data-cat="Aktiviteter" aria-pressed="false" aria-label="–§–∏–ª—å—Ç—Ä –∑–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–µ–π: Aktiviteter">
          <span class="cat-emoji" aria-hidden="true">üé≤</span>
          <span class="cat-uk">–î—ñ—è–ª—å–Ω–æ—Å—Ç—ñ</span>
          <span class="cat-no">(Aktiviteter)</span>
        </button>
      </div>

      <div style="margin-top:8px;">
        <label for="voiceSelect" style="font-size:0.95rem;">Velg stemme:</label>
        <select id="voiceSelect" style="min-width:180px; min-height:36px;"></select>
      </div>
    </div>
  </header>

  <main>
    <section id="cards" class="grid" aria-label="–ö–∞—Ä—Ç–∫–∏ —Ñ—Ä–∞–∑"></section>
  </main>



  <script src="ord/fraser.js"></script>
  <script>
  // ===================== D A T A =====================
  // DATA hentes n√• fra ekstern fil for enklere vedlikehold
  if (typeof DATA !== 'undefined') {
    DATA.forEach((x, i) => x.idx = i);
    // Legg til underkategorier for Aktiviteter hvis de ikke finnes
    const aktiviteter = [
      { emoji: 'ü§∏', uk: '–Ø —Ö–æ—á—É –≥—Ä–∞—Ç–∏—Å—è', no: 'Jeg vil leke', cat: 'Aktiviteter' },
      { emoji: 'üö∂', uk: '–Ø —Ö–æ—á—É –ø—ñ—Ç–∏ –Ω–∞ –ø—Ä–æ–≥—É–ª—è–Ω–∫—É', no: 'Jeg vil g√• en tur', cat: 'Aktiviteter' },
      { emoji: 'üé®', uk: '–Ø —Ö–æ—á—É –º–∞–ª—é–≤–∞—Ç–∏', no: 'Jeg vil tegne', cat: 'Aktiviteter' },
      { emoji: 'üß©', uk: '–Ø —Ö–æ—á—É —Å–∫–ª–∞–¥–∞—Ç–∏ –ø–∞–∑–ª–∏', no: 'Jeg vil pusle', cat: 'Aktiviteter' },
      { emoji: 'üéß', uk: '–Ø —Ö–æ—á—É —Å–ª—É—Ö–∞—Ç–∏ –º—É–∑–∏–∫—É', no: 'Jeg vil h√∏re p√• musikk', cat: 'Aktiviteter' },
      { emoji: 'üé≤', uk: '–Ø —Ö–æ—á—É –≥—Ä–∞—Ç–∏ –≤ —ñ–≥—Ä–∏', no: 'Jeg vil spille spill', cat: 'Aktiviteter' },
      { emoji: 'üìñ', uk: '–Ø —Ö–æ—á—É —á–∏—Ç–∞—Ç–∏', no: 'Jeg vil lese', cat: 'Aktiviteter' }
    ];
    aktiviteter.forEach((x, i) => {
      if (!DATA.some(d => d.no === x.no && d.cat === 'Aktiviteter')) {
        x.idx = DATA.length + i;
        DATA.push(x);
      }
    });
  }

    // ===================== S T A T E  +  F A V S =====================
    const state = { query: "", cat: "–£—Å—ñ", rate: 0.9 };
    const FAV_KEY = "fav_phrases_v1";
    const favSet = new Set(JSON.parse(localStorage.getItem(FAV_KEY) || "[]"));
    function persistFavs() { localStorage.setItem(FAV_KEY, JSON.stringify([...favSet])); }

    // ===================== H E L P E R S =====================
    function fold(s) {
      return (s || "")
        .normalize('NFD')
        .replace(/\p{Diacritic}/gu, '')
        .replace(/√¶/g, 'ae')
        .replace(/√∏/g, 'o')
        .replace(/√•/g, 'aa')
        .toLowerCase();
    }

    function isMatch(item, q) {
      // S√∏kefunksjon er fjernet, alltid true
      return true;
    }

    function sortWithFavs(items) {
      return items.slice().sort((a, b) => {
        const af = favSet.has(a.no) ? 1 : 0;
        const bf = favSet.has(b.no) ? 1 : 0;
        if (af !== bf) return bf - af; // favoritter f√∏rst
        return a.idx - b.idx;          // stabilt ellers
      });
    }

    // ===================== R E N D E R =====================
    const cardsEl = document.getElementById('cards');
  function announce(msg) {}

    function render() {
  const filtered = DATA.filter(x => (state.cat === "–£—Å—ñ" || x.cat === state.cat));
      const arr = sortWithFavs(filtered);
      cardsEl.innerHTML = "";

      for (const item of arr) {
        const card = document.createElement('article');
        card.className = 'card';
        card.setAttribute('tabindex', '0');
        card.setAttribute('role', 'button');
        card.setAttribute('aria-label', `–í—ñ–¥—Ç–≤–æ—Ä–∏—Ç–∏ —Ñ—Ä–∞–∑—É –Ω–æ—Ä–≤–µ–∑—å–∫–æ—é: ${item.no}`);
        card.dataset.no = item.no;
        card.dataset.cat = item.cat;

        const emoji = document.createElement('div');
        emoji.className = 'emoji';
        emoji.textContent = item.emoji;
        emoji.setAttribute('aria-hidden', 'true');

        // UKRAINIAN FIRST, BOLD AND LARGE
        const uk = document.createElement('div');
        uk.className = 'uk';
        uk.textContent = item.uk;
        uk.style.fontWeight = 'bold';
        uk.style.fontSize = '1.35rem';

        // NORWEGIAN BELOW, IN PARENTHESES, SMALLER
        const no = document.createElement('div');
        no.className = 'no';
        no.textContent = `(${item.no})`;
        no.style.fontWeight = 'normal';
        no.style.fontSize = '1rem';
        no.style.color = '#444';

        const actions = document.createElement('div');
        actions.className = 'actions';

        const speakBtn = document.createElement('button');
        speakBtn.className = 'iconbtn';
        speakBtn.type = 'button';
        speakBtn.textContent = 'üîä';
        speakBtn.setAttribute('aria-label', `–ü—Ä–æ—Å–ª—É—Ö–∞—Ç–∏ –Ω–æ—Ä–≤–µ–∑—å–∫—É —Ñ—Ä–∞–∑—É: ${item.no}`);

        const favBtn = document.createElement('button');
        favBtn.className = 'iconbtn';
        favBtn.type = 'button';
        const isFav = favSet.has(item.no);
        favBtn.textContent = isFav ? '‚≠ê' : '‚òÜ';
        favBtn.setAttribute('aria-label', (isFav ? '–í–∏–ª—É—á–∏—Ç–∏ –∑ –æ–±—Ä–∞–Ω–æ–≥–æ: ' : '–î–æ–¥–∞—Ç–∏ –¥–æ –æ–±—Ä–∞–Ω–æ–≥–æ: ') + item.no);
        favBtn.setAttribute('aria-pressed', String(isFav));
        favBtn.title = '–û–±—Ä–∞–Ω–µ';

        actions.appendChild(speakBtn);
        actions.appendChild(favBtn);

        card.appendChild(emoji);
        card.appendChild(uk);
        card.appendChild(no);
        card.appendChild(actions);

        card.addEventListener('click', (e) => {
          if ((e.target instanceof HTMLElement) && e.target.closest('button')) return;
          speak(item.no);
        });
        card.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            speak(item.no);
          }
        });

        speakBtn.addEventListener('click', () => speak(item.no));
        favBtn.addEventListener('click', (ev) => {
          ev.stopPropagation();
          if (favSet.has(item.no)) { favSet.delete(item.no); } else { favSet.add(item.no); }
          persistFavs();
          render();
        });

        cardsEl.appendChild(card);
      }

  // Ikke vis statusmelding
    }



    document.querySelectorAll('.chip').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.chip').forEach(b => b.setAttribute('aria-pressed', 'false'));
        btn.setAttribute('aria-pressed', 'true');
        state.cat = btn.dataset.cat;
        render();
      });
    });

    // ===================== T A L E  (speechSynthesis) =====================

    let selectedVoice = null;
    let voices = [];


    function populateVoiceList() {
      voices = window.speechSynthesis.getVoices();
      // Filtrer kun norske stemmer
      const norwegianVoices = voices.filter(v => /^nb|^no|^nn/i.test(v.lang));
      // Del opp i kvinner og menn
      const femaleVoices = norwegianVoices.filter(v => v.name.toLowerCase().includes('female') || v.name.toLowerCase().includes('kvinne') || v.gender === 'female');
      const maleVoices = norwegianVoices.filter(v => v.name.toLowerCase().includes('male') || v.name.toLowerCase().includes('mann') || v.gender === 'male');
      // Fallback hvis gender ikke er satt: bruk navn
      const otherVoices = norwegianVoices.filter(v => !femaleVoices.includes(v) && !maleVoices.includes(v));
      // Velg maks to av hver
      const limitedVoices = [
        ...femaleVoices.slice(0,2),
        ...maleVoices.slice(0,2)
      ];
      // Hvis det ikke finnes nok, fyll p√• med andre norske stemmer
      while (limitedVoices.length < 4 && otherVoices.length > 0) {
        limitedVoices.push(otherVoices.shift());
      }
      const voiceSelect = document.getElementById('voiceSelect');
      if (!voiceSelect) return;
      voiceSelect.innerHTML = '';
      limitedVoices.forEach((voice, i) => {
        const option = document.createElement('option');
        option.value = voices.indexOf(voice);
        option.textContent = `${voice.name} (${voice.lang})`;
        if (voice.gender === 'female' || voice.name.toLowerCase().includes('female') || voice.name.toLowerCase().includes('kvinne')) option.textContent += ' üë©';
        if (voice.gender === 'male' || voice.name.toLowerCase().includes('male') || voice.name.toLowerCase().includes('mann')) option.textContent += ' üë®';
        voiceSelect.appendChild(option);
      });
      // Velg f√∏rste stemme hvis mulig
      voiceSelect.selectedIndex = 0;
      selectedVoice = limitedVoices[0] || null;
    }


    function ensureVoiceReady() {
      populateVoiceList();
      const voiceSelect = document.getElementById('voiceSelect');
      if (voiceSelect) {
        voiceSelect.addEventListener('change', () => {
          selectedVoice = voices[voiceSelect.selectedIndex] || null;
          announce(selectedVoice ? `Stemme valgt: ${selectedVoice.name}` : 'Ingen stemme valgt.');
        });
      }
      if (selectedVoice) {
        const useFallback = !/^nb|^no|^nn/i.test(selectedVoice.lang || '');
        announce(useFallback ? '–ì–æ–ª–æ—Å –∑–Ω–∞–π–¥–µ–Ω–æ (—Ä–µ–∑–µ—Ä–≤–Ω–∏–π).' : '–ì–æ–ª–æ—Å –Ω–æ—Ä–≤–µ–∑—å–∫–æ—é –≥–æ—Ç–æ–≤–∏–π.');
      } else {
        announce('–ì–æ–ª–æ—Å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π. –°–ø—Ä–æ–±—É–π—Ç–µ –ø—ñ–∑–Ω—ñ—à–µ.');
      }
    }

    ensureVoiceReady();
    window.speechSynthesis.addEventListener('voiceschanged', ensureVoiceReady);

    function speak(text) {
      if (!('speechSynthesis' in window)) { announce('–û–∑–≤—É—á–µ–Ω–Ω—è –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è.'); return; }
      window.speechSynthesis.cancel();
      const u = new SpeechSynthesisUtterance(text);
      u.rate = state.rate; // standard hastighet
      u.lang = 'nb-NO';
      if (selectedVoice) u.voice = selectedVoice;
      u.onstart = () => announce(`–í–∏–º–æ–≤–∞: ${text}`);
  u.onend = () => {};
  u.onerror = () => {};
      window.speechSynthesis.speak(u);
    }

    // ===================== S T A R T =====================
    render();
  </script>
</body>
</html>
